/* Tori Mondello
 Robota Psyche 1 March 
 
 Note: Used Alpha's code as a reference. 
 
 */

FlowField f;
ArrayList<Vehicle> vehicles = new ArrayList<Vehicle>();

Food food;

void setup() {
  size (1200, 800);
  f = new FlowField(15);

  food = new Food(width/2, height/2);  

  // Make 4 "vehicles" to start with
  for (int i = 0; i < 4; i++) {
    vehicles.add(new Vehicle(random(width), random(height), 
      color(0, 255, 0), 
      random(2, 10), 
      random(0.05, 0.4), 
      1000, 
      100));
  }
}


void draw() {
  background(0);
  //f.followMouse();
  food.display();
  //trying to get new food to appear if it is completely eaten. NOTE: Doesn't work

  //if (vehicles.consumed == true) {
  //  food = new Food(random(width), random(height));
  //}

  for (Vehicle v : vehicles) {
    v.applyBehaviors(vehicles);
    v.seek(food.getLocation());
    v.flock(vehicles);
    v.follow(f); // Apply the steering force to follow the flow field
    v.update(); // Update the velocity and location, based on the acceleration generated by the steering force
    v.feed(food.getLocation());
    v.display(); // display the vehicle
  }

  for (int i = vehicles.size() - 1; i >= 0; i--) {
    Vehicle v = vehicles.get(i);
    v.consumeEnergy();
    if (!v.alive) {   //if energy level gets too low, consider them dead and remove the vehicle
      println("rip always in our hearts");
      vehicles.remove(v);
    }
  }
  if ((frameCount % 100) == 0) {
    Vehicle v = vehicles.get(int (random(vehicles.size())));
    DNA dna = v.getDNA();    //get the DNA from a random vehicle
    println("a new life is born");  



    // Now make a new vehicle using this DNA
    vehicles.add(new Vehicle(  //create new vehicle from that dna
      random(width), 
      random(height), 
      color(255, 0, 0), //change color to distinguish between old and new vehicles
      dna.bSize, 
      dna.maxF, 
      dna.initialEnergy, 
      dna.deadAt     
      ));
  }
}
